<link rel="import" href="../polymer/polymer.html"/>
<!--
@demo demo/full.html Full Demo
-->
<dom-module id="cosmoz-grouped-list-template-selector">
	<template>
		<style>
			:host ::slotted([hidden]) {
				display: none !important;
			}

			/* This will give a row with an opened dropdown a z-index higher than all other rows */
			:host(.has-dropdown) {
				z-index: 100;
			}
		</style>
		<slot></slot>
	</template>
	<script>
	(function () {
		'use strict';
		const IS_V2 = Polymer.flush != null;

		Polymer({
			is: 'cosmoz-grouped-list-template-selector',
			properties: {
				index: {
					type: Number
				},
				item: {
					type: Object,
					observer: '_onItemChanged'
				},
				hidden: {
					type: Boolean,
					observer: '_onHiddenChanged'
				},
			},

			attached() {
				this.listen(this, 'paper-dropdown-open', '_onDropdownOpen');
				this.listen(this, 'paper-dropdown-close', '_onDropdownClose');

				const {index, item, hidden} = this;

				if (IS_V2 && index == null && item == null) {
					return;
				}
				this._fireChange({index, item, hidden});
			},

			detached() {
				this.unlisten(this, 'paper-dropdown-open', '_onDropdownOpen');
				this.unlisten(this, 'paper-dropdown-close', '_onDropdownClose');
				this._fireChange({hidden: true});
			},

			_onItemChanged(item) {
				const {index, hidden} = this;
				if (item == null || hidden) {
					return;
				}
				this._fireChange({index, item});
			},

			_onHiddenChanged(hidden) {
				const {index, item} = this;
				this._fireChange({index, hidden, item});
			},

			_fireChange(props = {}) {
				this.fire('cosmoz-selector-changed', Object.assign({
					selector: this,
				}, props));
			},

			_onDropdownOpen(event) { // eslint-disable-line no-unused-vars
				this.classList.add('has-dropdown');
			},

			_onDropdownClose(event) { // eslint-disable-line no-unused-vars
				this.classList.remove('has-dropdown');
			}


		});
	})();
	</script>
</dom-module>
