<link rel="import" href="../polymer/polymer.html"/>
<!--
@demo demo/full.html Full Demo
-->
<dom-module id="cosmoz-grouped-list-template-selector">
	<template>
		<style>
			:host ::slotted([hidden]) {
				display: none !important;
			}

			/* This will give a row with an opened dropdown a z-index higher than all other rows */
			:host(.has-dropdown) {
				z-index: 100;
			}
		</style>
		<slot></slot>
	</template>
	<script>
	(function () {
		'use strict';

		Polymer({
			is: 'cosmoz-grouped-list-template-selector',
			properties: {
				index: {
					type: Number
				},
				item: {
					type: Object,
					observer: '_onItemChanged'
				},
				hidden: {
					type: Boolean,
					observer: '_onHiddenChanged'
				},
			},

			attached() {
				const {index, item, hidden} = this;
				this._fireChange({index, item, hidden});
			},

			detached() {
				this._fireChange({hidden: true});
			},

			_onItemChanged(item) {
				const {index, hidden} = this;
				if (item == null || hidden) {
					return;
			ready() {
				// HACK(pasleq) Because iron-list uses `translate3d` transform on row template instances,
				// a new stacking context is created for each row, preventing a dropdown to overflow the rows beneath.
				// In order to workaround this issue, increase the z-index of the row if it has an opened dropdown
				this.listen(this, 'paper-dropdown-open', '_onDropdownOpen');
				this.listen(this, 'paper-dropdown-close', '_onDropdownClose');
			},

			detached() {
				this.unlisten(this, 'paper-dropdown-open', '_onDropdownOpen');
				this.unlisten(this, 'paper-dropdown-close', '_onDropdownClose');
			},
				}
				this._fireChange({index, item});

			},
			_onHiddenChanged(hidden) {
				const {index, item} = this;
				this._fireChange({index, hidden, item});
			},

			_fireChange(props = {}) {
				this.fire('cosmoz-selector-changed', Object.assign({
					selector: this,
				}, props));
			}

		});
	})();
	</script>
</dom-module>
